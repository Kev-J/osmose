COMPILER = iverilog
SIMULATOR = vvp

SRC_CPU_INTERFACE = sn76489_cpu_interface.v
TB_CPU_INTERFACE = testbenches/sn76489_cpu_interface_tb.v
COUTPUT_CPU_INTERFACE = sn76489_cpu_interface
TBOUTPUT_CPU_INTERFACE = sn76489_cpu_interface_tb.vcd

SRC_TONE_GENERATOR = sn76489_tone_generator.v sn76489_volume_lut.v
TB_TONE_GENERATOR = testbenches/sn76489_tone_generator_tb.v
COUTPUT_TONE_GENERATOR = sn76489_tone_generator
TBOUTPUT_TONE_GENERATOR = sn76489_tone_generator_tb.vcd

SRC_NOISE_GENERATOR = sn76489_noise_generator.v sn76489_volume_lut.v
TB_NOISE_GENERATOR = testbenches/sn76489_noise_generator_tb.v
COUTPUT_NOISE_GENERATOR = sn76489_noise_generator
TBOUTPUT_NOISE_GENERATOR = sn76489_noise_generator_tb.vcd

all: $(TBOUTPUT_CPU_INTERFACE) $(TBOUTPUT_TONE_GENERATOR) ${TBOUTPUT_NOISE_GENERATOR}

# Simulate
$(TBOUTPUT_CPU_INTERFACE): ${COUTPUT_CPU_INTERFACE}
	${SIMULATOR} $^

$(TBOUTPUT_TONE_GENERATOR): ${COUTPUT_TONE_GENERATOR}
	${SIMULATOR} $^

$(TBOUTPUT_NOISE_GENERATOR): ${COUTPUT_NOISE_GENERATOR}
	${SIMULATOR} $^

# Compile
$(COUTPUT_CPU_INTERFACE): ${TB_CPU_INTERFACE} ${SRC_CPU_INTERFACE}
	${COMPILER} $^ -o $@

$(COUTPUT_TONE_GENERATOR): ${TB_TONE_GENERATOR} ${SRC_TONE_GENERATOR}
	${COMPILER} $^ -o $@

$(COUTPUT_NOISE_GENERATOR): ${TB_NOISE_GENERATOR} ${SRC_NOISE_GENERATOR}
	${COMPILER} $^ -o $@

.PHONY: clean

clean:
	rm -f ${COUTPUT_CPU_INTERFACE} ${TBOUTPUT_CPU_INTERFACE}
	rm -f ${COUTPUT_TONE_GENERATOR} ${TBOUTPUT_TONE_GENERATOR}
	rm -f ${COUTPUT_NOISE_GENERATOR} ${TBOUTPUT_NOISE_GENERATOR}
